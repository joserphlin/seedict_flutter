# 📚 辞书释义功能说明

## ✅ 已实现功能

### 1. 数据模型

**文件**: `lib/models/word_detail.dart`

#### WordFeng (冯爱珍词典)
- `text` - 词条
- `pronLiteral` - 本字音
- `pronSandhi` - 连读音
- `expls` - 释义列表（支持嵌套）
- `comment` - 注释
- `correction` - 校注
- `refPage` - 参考页码

#### FengExplNode (释义节点)
- `expl` - 释义内容
- `sent` - 例句列表
- `lexical` - 词性标记
- `node` - 子节点（支持嵌套释义）

#### WordCikLing (戚林八音)
- `text` - 词条
- `tone` - 声调
- `cikFinal` / `cikInitial` - 戚的韵母/声母
- `lingFinal` / `lingInitial` - 林的韵母/声母
- `cikAnnotation` / `lingAnnotation` - 注音
- `liAnnotateCik` / `liAnnotateLing` - 李如龙注释
- `comment` - 校注

### 2. UI 组件

**文件**: `lib/screens/word_screen.dart`

#### 冯爱珍词典卡片 (`_buildFengCard`)
- ✅ 词条和读音展示
- ✅ 嵌套释义支持
- ✅ 词性标记
- ✅ 例句展示
- ✅ 注释和校注
- ✅ 参考文献

#### 戚林八音卡片 (`_buildCikLingCard`)
- ✅ 多条目展示
- ✅ 戚林对照
- ✅ 注音信息
- ✅ 校注支持
- ✅ 参考文献

## 🎨 设计特点

### 冯爱珍词典

```
┌─────────────────────────────┐
│ 词条  /本字音/ → /连读音/    │
│                             │
│ [词性] 释义内容              │
│   • 例句1                   │
│   • 例句2                   │
│                             │
│ 注释：...                   │
│                             │
│ 参考文献                     │
│ ─────────────────────       │
│ 校注：...                   │
└─────────────────────────────┘
```

### 戚林八音

```
┌─────────────────────────────┐
│ ┌─────────────────────────┐ │
│ │ 词条                     │ │
│ │                         │ │
│ │ 戚: 声母韵母  林: 声母韵母│ │
│ │   注音         注音      │ │
│ └─────────────────────────┘ │
│                             │
│ 参考文献                     │
│ ─────────────────────       │
│ 校注：...                   │
└─────────────────────────────┘
```

## 📝 使用示例

### 在词汇详情页

辞书释义会自动显示在"本站释义"和"各地方音"之间：

1. **本站释义** - SeeDict 自己的释义
2. **辞书释义** ⬅️ 新增部分
   - 冯爱珍词典条目
   - 戚林八音条目
3. **各地方音** - 不同地区的读音
4. **用字一览** - 标准用字

## 🎯 功能特点

### 冯爱珍词典

1. **完整的读音信息**
   - 本字音（字面读音）
   - 连读音（实际读音）

2. **嵌套释义支持**
   - 主释义
   - 子释义（缩进显示）
   - 多层嵌套

3. **词性标记**
   - 名词、动词等词性
   - 小标签显示

4. **例句展示**
   - 斜体显示
   - 项目符号
   - 缩进排列

5. **学术信息**
   - 注释说明
   - 校注内容
   - 参考页码

### 戚林八音

1. **戚林对照**
   - 戚的声韵母
   - 林的声韵母
   - 并排显示

2. **注音信息**
   - 原书注音
   - 李如龙注释

3. **多条目支持**
   - 一个词可能有多个条目
   - 分别展示

## 🔧 技术实现

### 嵌套释义渲染

```dart
Widget _buildFengExplanations(List<FengExplNode> expls, {int level = 0}) {
  // 递归渲染，支持多层嵌套
  // level 参数控制缩进
}
```

### 条件渲染

```dart
// 只在有辞书数据时显示
if (_wordDetail!.fengs.isNotEmpty || _wordDetail!.ciklings.isNotEmpty) {
  // 显示辞书释义部分
}
```

### 数据解析

```dart
// 从 API 响应中解析
fengs: result['fengs'] != null
    ? (result['fengs'] as List)
        .map((item) => WordFeng.fromJson(item))
        .toList()
    : []
```

## 📊 数据流程

```
API Response
    ↓
WordDetailResponse.fromJson()
    ↓
fengs: List<WordFeng>
ciklings: List<WordCikLing>
    ↓
WordScreen
    ↓
_buildFengCard() / _buildCikLingCard()
    ↓
显示在 UI
```

## 🎨 样式设计

### 颜色方案

- **标题**: rosyBrown800 (#6C3333)
- **读音**: rosyBrown500
- **释义**: rosyBrown800
- **例句**: rosyBrown600 (斜体)
- **注释**: rosyBrown600
- **参考文献**: rosyBrown200
- **词性标签**: rosyBrown700 (白色文字)
- **背景**: wheat50

### 字体大小

- **词条**: 28px (冯) / 20px (戚林)
- **读音**: 16px
- **释义**: 14px
- **例句**: 13px
- **注释**: 14px
- **参考文献**: 12px

## 📚 参考文献格式

### 冯爱珍词典

```
冯爱珍. 福州方言词典. 南京: 江苏教育出版社, 1998: {页码}.
```

### 戚林八音

```
李如龙, 王升魁. 戚林八音校注. 福州: 福建人民出版社, 2001.
```

## 🔍 与原 Vue 版本对比

| 功能 | Vue 版本 | Flutter 版本 | 状态 |
|-----|---------|-------------|------|
| 冯爱珍词典 | ✅ | ✅ | 完成 |
| 戚林八音 | ✅ | ✅ | 完成 |
| 嵌套释义 | ✅ | ✅ | 完成 |
| 词性标记 | ✅ | ✅ | 完成 |
| 例句展示 | ✅ | ✅ | 完成 |
| 注释/校注 | ✅ | ✅ | 完成 |
| 参考文献 | ✅ | ✅ | 完成 |
| 用字切换 | ✅ | ⚠️ | 待实现 |

## 💡 未来改进

### 计划功能

1. **用字切换**
   - 原书用字 / 推荐用字
   - 切换按钮

2. **文本解析**
   - 支持特殊符号
   - 文本格式化

3. **交互增强**
   - 点击词条跳转
   - 展开/折叠长释义

4. **搜索功能**
   - 在辞书中搜索
   - 高亮显示

## ✅ 测试清单

- [x] 冯爱珍词典数据加载
- [x] 戚林八音数据加载
- [x] 嵌套释义渲染
- [x] 词性标记显示
- [x] 例句格式化
- [x] 注释和校注
- [x] 参考文献显示
- [ ] 用字切换功能
- [ ] 特殊文本解析

## 📖 使用提示

1. **查看辞书释义**
   - 打开任意词汇详情页
   - 滚动到"辞书释义"部分

2. **理解释义结构**
   - 主释义在左侧
   - 例句有缩进和项目符号
   - 词性用小标签标注

3. **参考文献**
   - 每个辞书都有完整引用
   - 冯爱珍词典包含页码

---

**状态**: ✅ 已完成
**版本**: 1.0.0
**更新时间**: 2024-12-11
